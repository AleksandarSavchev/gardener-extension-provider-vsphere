apiVersion: testmachinery.sapcloud.io/v1beta1
kind: Testrun
metadata:
  generateName: tm-extension-vsphere-
  namespace: default
spec:
  ttlSecondsAfterFinished: 172800 # 2 days
  locationSets:
    {{- if .Values.localLocation }}
    - default: true
      name: local
      locations:
        - type: local
          hostPath: /tmp/tm # hostpath to a directory containing TestDefinition
    {{ else }}
    - default: true
      name: provider-vsphere
      locations:
        - type: git
          repo: https://github.com/gardener/gardener-extension-provider-vsphere.git
          revision: {{ default "main" .Values.revision }}
    {{ end }}

  {{/* Config items are global to for both gcve-setup and gcve-teardown */}}
  config:
    - name: SERVICEACCOUNT_JSON
      type: env
      valueFrom:
        secretKeyRef:
          name: shoot-operator-vsphere
          key: serviceaccount.json
    - name: REGION
      type: env
      value: us-east4
    - name: OVPN_CONFIG
      type: file
      path: /tmp/tm/shared/generators/ovpn.zip
      value: "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"

  testflow:
    - name: gcve-setup
      definition:
        name: gcve-setup
        config:
          - name: PHASE
            type: env
            value: "dummy"
    - name: infrastructure-test
      dependsOn: [ gcve-setup ]
      definition:
        name: infrastructure-test

  onExit:
    - name: gcve-teardown
      condition: always
      definition:
        name: gcve-setup
        config:
          - name: PHASE
            type: env
            value: shutdown
